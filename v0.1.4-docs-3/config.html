<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuration - Dip</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="intro.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li><a href="deployment.html"><strong aria-hidden="true">2.</strong> Deployment</a></li><li><a href="config.html" class="active"><strong aria-hidden="true">3.</strong> Configuration</a></li><li><a href="handlers.html"><strong aria-hidden="true">4.</strong> Built-in Handlers</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Dip</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#configuration" id="configuration"><h1>Configuration</h1></a>
<p>The configuration directory should contain two subdirectories: <code>handlers</code> and <code>hooks</code>. The <code>hooks</code> directory should contain configuration files for webhooks. These files are defined in <a href="https://github.com/toml-lang/toml">TOML</a>. For example, here is a config file for a website deployment using gutenberg:</p>
<pre><code class="language-toml">[[handlers]]
type = &quot;github&quot;
secret = &quot;**************&quot;

[[handlers]]
type = &quot;command&quot;
command = &quot;rm -rf /var/www/default/*&quot;

[[handlers]]
type = &quot;command&quot;
command = &quot;gutenberg build --output-dir /var/www/default&quot;
</code></pre>
<p>If this config file existed at <code>$DIP_ROOT/hooks/website</code>, then it would be served from <code>http://localhost:5000/webhook/website</code>.</p>
<a class="header" href="#config-file-format" id="config-file-format"><h2>Config File Format</h2></a>
<p>The hook config should contain an array called <code>handlers</code>, which is a sequence of <code>handler</code> tables.</p>
<a class="header" href="#the-type-key" id="the-type-key"><h4>The <code>type</code> key</h4></a>
<p>Each <code>handler</code> must contain at least one key required by dip, <code>type</code>, which determines what kind of hook will be run.</p>
<p>Dip comes with two built-in handlers:</p>
<ul>
<li><a href="handlers.html#bash-commands"><code>command</code></a></li>
<li><a href="handlers.html#github-webhooks"><code>github</code></a></li>
</ul>
<p>If you set <code>type</code> to one of these values, dip will automatically use the built-in. Otherwise, dip will look into the <code>handlers</code> subdirectory for an executable matching the <code>type</code> that you specified. For example, if you set <code>type = &quot;mkdir&quot;</code>, then it will look for <code>$DIP_ROOT/handlers/mkdir</code>, which must be an executable file. It will <em>not</em> run the system <code>mkdir</code>. If you want to run the system <code>mkdir</code>, use <code>type = &quot;command&quot;</code>, so it will run a bash command instead.</p>
<a class="header" href="#handler-input-and-output" id="handler-input-and-output"><h2>Handler Input and Output</h2></a>
<p>Think of a handler as a function that takes two inputs: a configuration and per-instance data. The configuration is specified in the configuration file, while the per-instance data is specific to that run of the webhook.</p>
<p>For example, suppose we have the following setup:</p>
<pre><code class="language-toml">[[handlers]]
type = &quot;github&quot;
secret = &quot;hunter2&quot;
</code></pre>
<p>If a new Github webhook is deployed, then the first config input will be:</p>
<pre><code class="language-json">{
    &quot;secret&quot;: &quot;hunter2&quot;
}
</code></pre>
<p>This input will be provided to the executable using <code>--config</code> in JSON format. For example, if <code>github</code> was not a builtin, then a call to the <code>github</code> executable might look like:</p>
<pre><code class="language-bash">/usr/bin/github --config '{&quot;secret&quot;:&quot;hunter2&quot;}'
</code></pre>
<p>The second input that's provided to the handler is information specific to this run. For the first handler in the sequence, this will be data serialized from the HTTP request, and for subsequent handlers, it will be the output of the previous handler. This input is provided through standard input directly as is.</p>
<p>Think of it as a fold over the list of handlers:</p>
<pre><code class="language-hs">foldl (\input next_handler -&gt; next_handler input) http_data handlers
</code></pre>
<a class="header" href="#environment-variables" id="environment-variables"><h3>Environment Variables</h3></a>
<p>Every process spawned by Dip as part of a webhook will have certain variables set to give it information about its environment:</p>
<ul>
<li><code>DIP_ROOT</code>: the root config directory for Dip.</li>
<li><code>DIP_WORKDIR</code>: the temporary directory created for this specific hook invocation.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="deployment.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="handlers.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="deployment.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="handlers.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
